<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src * wss:; media-src *"
    />
    <title>Voice Terminal</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Drag bar for moving window -->
    <div class="drag-bar"></div>

    <!-- Terminal Selector -->
    <div class="section terminal-selector">
      <label>Target Terminal</label>
      <div class="terminal-dropdown" id="terminal-dropdown">
        <button class="dropdown-trigger" id="dropdown-trigger">
          <span class="dropdown-trigger-text">Detecting Kitty windows...</span>
          <svg class="dropdown-arrow" width="10" height="6" viewBox="0 0 10 6" fill="none">
            <path d="M1 1L5 5L9 1" stroke="#86868b" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="dropdown-list" id="dropdown-list"></div>
        <div class="terminal-preview" id="terminal-preview">
          <span class="preview-placeholder">Hover a terminal to preview...</span>
        </div>
      </div>
    </div>

    <!-- Mic Button -->
    <div class="section mic-section">
      <button id="mic-btn" class="mic-button" title="Click to start listening">
        <svg
          id="mic-icon"
          viewBox="0 0 24 24"
          width="32"
          height="32"
          fill="currentColor"
        >
          <path
            d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z"
          />
          <path
            d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"
          />
        </svg>
        <span id="mic-label">Start</span>
      </button>
      <div id="status-text" class="status idle">Idle</div>
    </div>

    <!-- Live Transcript -->
    <div class="section transcript-section">
      <div class="section-header">
        <span>Live Transcript</span>
        <div class="header-actions">
          <button id="edit-btn" class="icon-btn" title="Edit transcript" style="display:none;">
            <svg viewBox="0 0 16 16" width="12" height="12" fill="currentColor">
              <path d="M11.13 1.47a1.5 1.5 0 0 1 2.12 0l1.28 1.28a1.5 1.5 0 0 1 0 2.12L5.9 13.5 1.5 14.5l1-4.4 8.63-8.63zM3.35 10.35l-.6 2.6 2.6-.6 7.78-7.78-2-2-7.78 7.78z"/>
            </svg>
          </button>
          <button id="clear-btn" class="text-btn" title="Clear transcript">
            Clear
          </button>
        </div>
      </div>
      <div id="transcript" class="transcript-box" contenteditable="false" spellcheck="false">
        <span class="placeholder">Transcript will appear here...</span>
      </div>
    </div>

    <!-- Corrected Command -->
    <div class="section command-section">
      <div class="section-header">
        <span>Corrected Command</span>
      </div>
      <div id="command-box" class="command-box">
        <span class="placeholder">â€”</span>
      </div>
      <div class="command-actions">
        <button id="send-btn" class="send-button" disabled>
          Send to Terminal
        </button>
      </div>
    </div>

    <!-- Footer actions -->
    <div class="quit-section">
      <button id="reset-keys-btn" class="quit-btn">Reset API Keys</button>
      <span class="footer-sep">&middot;</span>
      <button id="quit-btn" class="quit-btn">Quit</button>
    </div>

    <!-- API Key Error Dialog -->
    <div id="key-error-overlay" class="dialog-overlay" style="display:none;">
      <div class="dialog-box">
        <div class="dialog-title">Invalid API Key</div>
        <div id="key-error-msg" class="dialog-msg"></div>
        <div class="dialog-actions">
          <button id="key-error-reset" class="dialog-btn-primary">Update Keys</button>
          <button id="key-error-dismiss" class="dialog-btn-secondary">Dismiss</button>
        </div>
      </div>
    </div>

    <script src="stt.js"></script>
    <script src="stopword.js"></script>
    <script src="renderer.js"></script>
  </body>
</html>
