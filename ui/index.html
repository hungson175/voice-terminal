<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src * wss:; media-src *"
    />
    <title>Voice Terminal</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Drag bar for moving window -->
    <div class="drag-bar">
      <button id="config-toggle" class="config-toggle" title="STT Context Settings">
        <svg viewBox="0 0 20 20" width="14" height="14" fill="currentColor">
          <path d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.062 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"/>
        </svg>
      </button>
    </div>

    <!-- Config Panel (hidden by default) -->
    <div id="config-panel" style="display:none;">
      <div class="config-header">
        <button id="config-back" class="config-back-btn" title="Back to main view">
          <svg viewBox="0 0 20 20" width="14" height="14" fill="currentColor">
            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
          </svg>
        </button>
        <span class="config-title">STT Context Settings</span>
      </div>

      <div class="config-section">
        <label class="config-label">Terms <span class="config-hint">(comma-separated)</span></label>
        <textarea id="config-terms" class="terms-textarea" rows="4" spellcheck="false" placeholder="Claude Code, tmux, API, ..."></textarea>
      </div>

      <div class="config-section">
        <label class="config-label">Translation Terms</label>
        <table class="translation-table">
          <thead>
            <tr>
              <th>Source (misheard)</th>
              <th>Target (correct)</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="translation-tbody"></tbody>
        </table>
        <button id="add-row-btn" class="add-row-btn">+ Add Row</button>
      </div>

      <div class="config-actions">
        <button id="config-save" class="config-save-btn">Save</button>
        <button id="config-reset" class="config-reset-btn">Reset to Defaults</button>
      </div>
      <div id="config-status" class="config-status"></div>
    </div>

    <!-- Main Panel -->
    <div id="main-panel">
    <!-- Terminal Selector -->
    <div class="section terminal-selector">
      <label>Target Terminal</label>
      <div class="terminal-dropdown" id="terminal-dropdown">
        <button class="dropdown-trigger" id="dropdown-trigger">
          <span class="dropdown-trigger-text">Detecting Kitty windows...</span>
          <svg class="dropdown-arrow" width="10" height="6" viewBox="0 0 10 6" fill="none">
            <path d="M1 1L5 5L9 1" stroke="#86868b" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="dropdown-list" id="dropdown-list"></div>
        <div class="terminal-preview" id="terminal-preview">
          <span class="preview-placeholder">Hover a terminal to preview...</span>
        </div>
      </div>
    </div>

    <!-- Mic Button -->
    <div class="section mic-section">
      <button id="mic-btn" class="mic-button" title="Click to start listening">
        <svg
          id="mic-icon"
          viewBox="0 0 24 24"
          width="32"
          height="32"
          fill="currentColor"
        >
          <path
            d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z"
          />
          <path
            d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"
          />
        </svg>
        <span id="mic-label">Start</span>
      </button>
      <div id="status-text" class="status idle">Idle</div>
    </div>

    <!-- Vietnamese Transcript (original) -->
    <div class="section transcript-section">
      <div class="section-header">
        <span>Vietnamese</span>
        <div class="header-actions">
          <button id="edit-btn" class="icon-btn" title="Edit transcript" style="display:none;">
            <svg viewBox="0 0 16 16" width="12" height="12" fill="currentColor">
              <path d="M11.13 1.47a1.5 1.5 0 0 1 2.12 0l1.28 1.28a1.5 1.5 0 0 1 0 2.12L5.9 13.5 1.5 14.5l1-4.4 8.63-8.63zM3.35 10.35l-.6 2.6 2.6-.6 7.78-7.78-2-2-7.78 7.78z"/>
            </svg>
          </button>
          <button id="clear-btn" class="text-btn" title="Clear transcript">
            Clear
          </button>
        </div>
      </div>
      <div id="transcript" class="transcript-box" contenteditable="false" spellcheck="false">
        <span class="placeholder">Vietnamese transcript...</span>
      </div>
    </div>

    <!-- English Transcript (translated) -->
    <div class="section transcript-section">
      <div class="section-header">
        <span>English</span>
      </div>
      <div id="translated" class="transcript-box">
        <span class="placeholder">English translation...</span>
      </div>
    </div>

    <!-- Corrected Command -->
    <div class="section command-section">
      <div class="section-header">
        <span>Command</span>
      </div>
      <div id="command-box" class="command-box">
        <span class="placeholder">â€”</span>
      </div>
      <div class="command-actions">
        <button id="send-btn" class="send-button" disabled>
          Send to Terminal
        </button>
      </div>
    </div>

    <!-- Footer actions -->
    <div class="quit-section">
      <button id="reset-keys-btn" class="quit-btn">Reset API Keys</button>
      <span class="footer-sep">&middot;</span>
      <button id="quit-btn" class="quit-btn">Quit</button>
    </div>

    </div><!-- end #main-panel -->

    <!-- API Key Error Dialog -->
    <div id="key-error-overlay" class="dialog-overlay" style="display:none;">
      <div class="dialog-box">
        <div class="dialog-title">Invalid API Key</div>
        <div id="key-error-msg" class="dialog-msg"></div>
        <div class="dialog-actions">
          <button id="key-error-reset" class="dialog-btn-primary">Update Keys</button>
          <button id="key-error-dismiss" class="dialog-btn-secondary">Dismiss</button>
        </div>
      </div>
    </div>


    <script src="stt.js"></script>
    <script src="stopword.js"></script>
    <script src="renderer.js"></script>
  </body>
</html>
